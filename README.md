# 네트워크 슈퍼 마리오 브라더스

Java 소켓 프로그래밍을 활용한 권한 서버 기반 멀티플레이어 슈퍼 마리오 게임

## 개요

클래식 슈퍼 마리오 브라더스를 네트워크 멀티플레이어로 구현한 프로젝트입니다. 서버가 모든 게임 상태를 관리하고, 클라이언트는 렌더링과 입력 처리만 담당합니다. 단일 공유 방에서 최대 4명의 플레이어가 동시에 게임을 플레이할 수 있습니다.

**과목**: 네트워크프로그래밍, 2025년 2학기  
**소속**: 한성대학교 컴퓨터공학부  
**작성자**: 김민상

## 주요 기능

- 서버 권한 게임 아키텍처
- 최대 4명 동시 플레이 지원
- 단일 공유 방 시스템 및 준비 메커니즘
- 2개 스테이지 선택 가능 (Map 1, Map 2)
- 클래식 마리오 메커니즘: 파워업, 적, 아이템, 물리
- 데미지 무적 시간 (2초 i-frames)
- 클라이언트별 독립 카메라
- 60Hz 클라이언트 렌더링, 20Hz 서버 상태 브로드캐스트

## 아키텍처

### 서버
- 독립 프로세스로 실행
- 60Hz로 모든 게임 로직 처리
- 20Hz로 클라이언트에 게임 상태 브로드캐스트
- 단일 공유 방 관리
- 충돌 감지, 물리, 게임 규칙 처리

### 클라이언트
- TCP를 통해 서버 연결
- 입력 이벤트를 서버로 전송
- 60Hz로 게임 상태 렌더링
- 각 클라이언트는 할당된 플레이어를 독립 카메라로 추적

### 네트워크 프로토콜

Java 직렬화 기반 TCP 커스텀 프로토콜:

- `CONNECT` - 플레이어 이름과 함께 초기 연결 요청
- `CONNECTED` - 서버가 클라이언트 ID 할당
- `CREATE_ROOM` - 선택한 맵으로 방 생성 요청
- `JOIN_ROOM` - 기존 방 참가 요청
- `READY` - 준비 상태 토글
- `INPUT` - 키보드 입력을 서버로 전송
- `GAME_STATE` - 서버가 전체 게임 상태 브로드캐스트
- `ROOM_INFO` - 방 상태 업데이트 (플레이어 수, 방장)
- `GAME_START` - 서버가 게임 시작 신호 전송

## 요구사항

- Java 8 이상
- Windows (배치 스크립트 제공)

## 빌드

전체 프로젝트 컴파일:

```powershell
javac -encoding UTF-8 -d . -sourcepath src src/manager/GameEngine.java
```

또는 제공된 스크립트 사용:

```powershell
.\compile.bat
```

## 실행

### 서버 실행

```powershell
java -cp ".;src" network.server.GameServer
```

또는:

```powershell
.\run_server.bat
```

서버는 `0.0.0.0:25565`에서 클라이언트 연결을 대기합니다.

### 클라이언트 실행

```powershell
java -cp ".;src" manager.GameEngine
```

또는:

```powershell
.\run_game.bat
```

**방 생성:**
1. 시작 화면에서 "CREATE ROOM" 선택
2. Stage 1 또는 Stage 2 선택
3. 다른 플레이어 대기
4. SPACE를 눌러 READY 상태 토글
5. 모든 플레이어가 준비되면 게임 시작

**방 참가:**
1. 시작 화면에서 "JOIN ROOM" 선택
2. SPACE를 눌러 READY 상태 토글
3. 모든 플레이어가 준비되면 게임 시작

## 조작법

### 메뉴 조작
- `↑` / `↓` - 메뉴 탐색
- `ENTER` - 선택 확인
- `ESC` - 시작 화면으로 돌아가기

### 게임 플레이
- `←` / `→` - 좌우 이동
- `SPACE` - 점프
- `X` - 파이어볼 발사 (Fire Mario만 가능)
- `P` - 일시정지/재개

## 맵 제작

PNG 이미지의 픽셀 색상으로 맵을 디자인할 수 있습니다.

자세한 가이드: [MAP_COLOR_GUIDE.md](MAP_COLOR_GUIDE.md)

**새로운 기능:**
- 물음표 블록 아이템 타입별 배치 (코인, 슈퍼버섯, 파이어플라워, 1UP)
- 숨겨진 아이템 블록 (일반 블록처럼 보이지만 내부에 아이템)
- 기존 랜덤 블록도 계속 지원

## 프로젝트 구조

```
Super-Mario-Bros/
├── src/
│   ├── manager/              # 핵심 게임 시스템
│   │   ├── GameEngine.java   # 클라이언트 게임 루프 및 상태 관리
│   │   ├── MapManager.java   # 서버측 게임 로직
│   │   ├── InputManager.java # 입력 처리
│   │   └── Camera.java       # 뷰포트 관리
│   ├── model/                # 게임 엔티티
│   │   ├── hero/             # 마리오, 파이어볼
│   │   ├── enemy/            # 굼바, 쿠파 트루파
│   │   ├── brick/            # 블록, 파이프
│   │   └── prize/            # 아이템 (버섯, 코인, 파이어플라워)
│   ├── view/                 # 렌더링
│   │   ├── UIManager.java    # 메인 렌더러
│   │   ├── ImageLoader.java  # 리소스 로더
│   │   └── Animation.java    # 스프라이트 애니메이션
│   ├── network/              # 네트워킹 레이어
│   │   ├── NetworkManager.java      # 클라이언트 네트워크 추상화
│   │   ├── server/
│   │   │   ├── GameServer.java      # 권한 서버
│   │   │   ├── ClientHandler.java   # 클라이언트별 연결 핸들러
│   │   │   └── Room.java            # 방 상태 관리
│   │   ├── client/
│   │   │   └── GameClient.java      # 저수준 TCP 클라이언트
│   │   └── protocol/                # 메시지 정의
│   │       ├── MessageType.java
│   │       ├── GameStateMessage.java
│   │       └── ...
│   ├── ranking/              # 랭킹 시스템
│   └── media/                # 게임 에셋 (스프라이트, 사운드, 맵)
├── compile.bat               # 컴파일 스크립트
├── run_game.bat              # 클라이언트 실행 스크립트
├── run_server.bat            # 서버 실행 스크립트
└── README.md
```

## 기술 상세

### 게임 루프

**서버:**
- 60Hz 게임 로직 틱 (물리, 충돌, AI)
- 20Hz 클라이언트 상태 브로드캐스트
- 1Hz 시간 감소

**클라이언트:**
- 60Hz 렌더링 루프
- 입력 발생 즉시 서버로 전송
- 서버 메시지로부터 상태 적용

### 충돌 감지

서버가 모든 충돌 검사 수행:
- 마리오 vs 적 (위에서 밟기, 옆에서 데미지)
- 마리오 vs 블록 (블록 충돌, 물음표 블록 활성화)
- 마리오 vs 아이템 (파워업 획득)
- 파이어볼 vs 적
- 엔티티 vs 맵 경계

### 파워업 시스템

- Small Mario: 기본 폼, 한 번에 사망
- Super Mario: 한 번 맞으면 Small로 다운그레이드
- Fire Mario: 파이어볼 발사 가능, 한 번 맞으면 Super로 다운그레이드

데미지 무적: 데미지 후 2초 i-frames (스타 무적과 별개)

### 방 시스템

단일 공유 방으로 모든 플레이어가 같은 게임 인스턴스에 참여:
- 방장이 방 생성 시 맵 선택
- 모든 플레이어가 준비해야 게임 시작
- 방은 수동으로 리셋할 때까지 서버에 유지

## 개발 정보

한성대학교 네트워크프로그래밍 수업 과제로 개발되었습니다.

### 주요 구현 사항

- 서버 권한: 클라이언트는 로컬 게임 로직을 실행하지 않음
- 모든 게임 상태는 50ms마다 `GameStateMessage`로 직렬화
- 플레이어 인덱스 1-4 (인덱스 0은 미사용)
- 카메라는 할당된 플레이어를 스크롤 로직으로 추적
- HUD는 플레이어별 스탯 렌더링 (생명, 점수, 코인, 시간)

### 알려진 제한사항

- 서버 주소가 `localhost:25565`로 하드코딩됨
- 재연결 지원 없음
- 클라이언트측 예측 및 보간 없음
- 최대 4명 플레이어로 제한

## 출처

원본 슈퍼 마리오 브라더스 구현:  
https://github.com/ahmetcandiroglu/Super-Mario-Bros

교육 목적으로 멀티플레이어 네트워킹 기능 추가.
